var nextGroupNumber=0;var groupSearches=new Array;function addSearch(group,term,field){if(term==undefined){term=""}if(field==undefined){field=""}var newSearch="";newSearch+="<div class='row form-inline'>";newSearch+="<div class='searchLabel col-sm-2'>"+(groupSearches[group]==0?searchLabel+" :":"&nbsp;")+"</div>";newSearch+="<div class='input-group col-sm-10'><input type='text' aria-label='search phrase' class='form-control' name='lookfor"+group+"[]'  value='"+jsEntityEncode(term)+"'>";newSearch+="<span class='input-group-addon'>"+searchFieldLabel+" </span>";newSearch+="<select aria-label='type of search' class='form-control' name='type"+group+"[]'>";for(key in searchFields){newSearch+="<option value='"+key+"'";if(key==field){newSearch+=" selected='selected'"}newSearch+=">"+searchFields[key]+"</option>"}newSearch+="</select>";newSearch+="</div>";$("#group"+group+"SearchHolder").append(newSearch).find("[name^=lookfor]").filter(":last").keypress(function(e){if(e.which==13){e.preventDefault()}});groupSearches[group]++}function addGroup(firstTerm,firstField,join){if(firstTerm==undefined){firstTerm=""}if(firstField==undefined){firstField=""}if(join==undefined){join=""}var newGroup="";newGroup+="<div id='group"+nextGroupNumber+"' class='group group"+nextGroupNumber%2+" well well-sm'>";newGroup+="<div class='groupSearchDetails clearfix'>";newGroup+="<button class='delete btn btn-sm btn-warning' id='delete_link_"+nextGroupNumber+"' onclick='deleteGroupJS(this);'>"+deleteSearchGroupString+"</button>";newGroup+="<label for='join"+nextGroupNumber+"' class='join'>"+searchMatch+" : ";newGroup+="<select id='join"+nextGroupNumber+"' name='bool"+nextGroupNumber+"[]'>";for(key in searchJoins){newGroup+="<option value='"+key+"'";if(key==join){newGroup+=" selected='selected'"}newGroup+=">"+searchJoins[key]+"</option>"}newGroup+="</select>";newGroup+="</label>";newGroup+="</div>";newGroup+="<div id='group"+nextGroupNumber+"SearchHolder' class='groupSearchHolder'></div>";newGroup+="<div class='addSearch row'><div class='col-sm-4 col-sm-offset-2'><button class='add btn btn-sm btn-default' id='add_search_link_"+nextGroupNumber+"' onclick='addSearchJS(this);'>"+addSearchString+"</button></div></div>";newGroup+="</div>";groupSearches[nextGroupNumber]=0;$("#searchHolder").append($(newGroup).hide());$("#group"+nextGroupNumber).fadeIn();addSearch(nextGroupNumber,firstTerm,firstField);reSortGroups();return nextGroupNumber-1}function deleteGroupJS(elem){$(elem).parents(".group").fadeOut(function(){$(this).remove();reSortGroups()});return false}function addSearchJS(group){var groupNum=group.id.replace("add_search_link_","");addSearch(groupNum);return false}function reSortGroups(){var groups=0;$("#searchHolder").children().each(function(){if(this.id!=undefined){if(this.id!="group"+groups){reNumGroup(this,groups)}groups++}});nextGroupNumber=groups;if(nextGroupNumber>1){$("#groupJoin").fadeIn()}else{$("#groupJoin").fadeOut()}$("#delete_link_0").css("display",nextGroupNumber==1?"none":"inline");if(nextGroupNumber==0){addGroup()}}function reNumGroup(oldGroup,newNum){var oldId=oldGroup.id,oldNum=oldId.substring(5,oldId.length);if(oldNum!=newNum){$(oldGroup).attr("id","group"+newNum).removeClass("group0 group1").addClass("group"+newNum%2);$(".delete",oldGroup).attr("id","delete_link_"+newNum);$('[name="bool'+oldNum+'[]"]',oldGroup).attr("name","bool"+newNum+"[]");$(".add",oldGroup).attr("id","add_search_link_"+newNum);var sHolder=$(".groupSearchHolder",oldGroup).attr("id","group"+newNum+"SearchHolder");$(".terms",sHolder).attr("name","lookfor"+newNum+"[]");$(".field",sHolder).attr("name","type"+newNum+"[]")}}function jsEntityEncode(str){var new_str=str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return new_str}function resetSearch(){$('input[type="text"]').val("");$("option:selected").removeAttr("selected").parent().change();$(".delete").not("#delete_link_0").each(function(){deleteGroupJS(this)})}