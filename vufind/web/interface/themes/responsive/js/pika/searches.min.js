Pika.Searches=function(){$(function(){console.log("Searches loading");Pika.Searches.enableSearchTypes();Pika.Searches.initAutoComplete();if(!Globals.opac&&!Globals.loggedIn&&Pika.hasLocalStorage()&&$('input[name="showCovers"]').length==0){var showCovers=window.localStorage.getItem("showCovers")||false;if(showCovers.length>0){$("<input>").attr({type:"hidden",name:"showCovers",value:showCovers}).appendTo("#searchForm")}}});return{searchGroups:[],curPage:1,displayMode:"list",displayModeClasses:{covers:"home-page-browse-thumbnails",list:""},getCombinedResults:function(fullId,shortId,source,searchTerm,searchType,numberOfResults){var url="/Union/AJAX",params={method:"getCombinedResults",source:source,numberOfResults:numberOfResults,id:fullId,searchTerm:searchTerm,searchType:searchType,showCovers:$("#hideCovers").is(":checked")?"on":"off"},section=$("#combined-results-section-results-"+shortId);$.getJSON(url,params,function(data){if(data.success===false){section.html('<div class="clearfix"></div>Error loading results.<br>'+data.error)}else{section.html(data.results)}}).fail(function(){section.html('<div class="clearfix"></div>Failed to fetch results.')});return false},combinedResultsDefinedOrder:[],reorderCombinedResults:function(){if($("#combined-results-column-0").is(":visible")){if($(".combined-results-column-0","#combined-results-column-0").length==0){$(".combined-results-column-0").detach().appendTo("#combined-results-column-0");$(".combined-results-column-1").detach().appendTo("#combined-results-column-1")}}else{if($(".combined-results-section","#combined-results-all-column").length==0){$.each(Pika.Searches.combinedResultsDefinedOrder,function(i,id){el=$(id).parents(".combined-results-section").detach().appendTo("#combined-results-all-column")})}}return false},getPreferredDisplayMode:function(){if(!Globals.opac&&Pika.hasLocalStorage()){temp=window.localStorage.getItem("searchResultsDisplayMode");if(Pika.Searches.displayModeClasses.hasOwnProperty(temp)){Pika.Searches.displayMode=temp;$('input[name="view"]',"#searchForm").val(Pika.Searches.displayMode)}}},toggleDisplayMode:function(selectedMode){var mode=this.displayModeClasses.hasOwnProperty(selectedMode)?selectedMode:this.displayMode,searchBoxView=$('input[name="view"]',"#searchForm"),paramString=Pika.replaceQueryParam("page","",Pika.replaceQueryParam("view",mode));this.displayMode=mode;this.curPage=1;if(searchBoxView)searchBoxView.val(this.displayMode);if(!Globals.opac&&Pika.hasLocalStorage()){window.localStorage.setItem("searchResultsDisplayMode",this.displayMode)}if(mode=="list")$("#hideSearchCoversSwitch").show();else $("#hideSearchCoversSwitch").hide();location.replace(location.pathname+paramString)},getMoreResults:function(){var url="/Search/AJAX",params=Pika.replaceQueryParam("page",this.curPage+1)+"&method=getMoreSearchResults",divClass=this.displayModeClasses[this.displayMode];params=Pika.replaceQueryParam("view",this.displayMode,params);if(params.search(/[?;&]replacementTerm=/)!=-1){var searchTerm=location.search.split("replacementTerm=")[1].split("&")[0];params=Pika.replaceQueryParam("lookfor",searchTerm,params)}$.getJSON(url+params,function(data){if(data.success==false){Pika.showMessage("Error loading search information","Sorry, we were not able to retrieve additional results.")}else{var newDiv=$(data.records).hide();$("."+divClass).filter(":last").after(newDiv);newDiv.fadeIn("slow");if(data.lastPage)$("#more-browse-results").hide();else Pika.Searches.curPage++}}).fail(Pika.ajaxFail);return false},initAutoComplete:function(){try{var usingHorizontalSearchBox=$("#horizontal-search-box").is(":visible");$("#lookfor").autocomplete({source:function(request,response){var url="/Search/AJAX",params={method:"GetAutoSuggestList",searchTerm:$("#lookfor").val(),searchType:$("#basicSearchTypes").val()};$.getJSON(url,params,function(data){if(usingHorizontalSearchBox&&data.length>10)data=data.slice(0,10);var suggestions=usingHorizontalSearchBox?data.reverse():data;response(suggestions)})},position:{my:usingHorizontalSearchBox?"left bottom":"left top",at:usingHorizontalSearchBox?"left top":"left bottom",of:"#lookfor",collision:"none"},minLength:4,delay:600})}catch(e){alert("error during autocomplete setup"+e)}},sendEmail:function(){var url="/Search/AJAX";$.getJSON(url,{method:"sendEmail",from:$("#from").val(),to:$("#to").val(),message:$("#message").val(),sourceUrl:window.location.href,"g-recaptcha-response":typeof grecaptcha!=="undefined"?grecaptcha.getResponse():false},function(data){if(data.result){Pika.showMessage("Success",data.message)}else{Pika.showMessage("Error",data.message)}});return false},enableSearchTypes:function(){var searchTypeElement=$("#searchSource");var catalogType="catalog";if(searchTypeElement){var selectedSearchType=$(searchTypeElement.find(":selected"));if(selectedSearchType){catalogType=selectedSearchType.data("catalog_type")}}if(catalogType=="islandora"){$(".islandoraType").show();$(".catalogType,.genealogyType,.ebscoType").hide()}else if(catalogType=="genealogy"){$(".genealogyType").show();$(".catalogType,.islandoraType,.ebscoType").hide()}else if(catalogType=="ebsco"){$(".ebscoType").show();$(".catalogType,.islandoraType,.genealogyType").hide()}else{$(".catalogType").show();$(".genealogyType,.islandoraType,.ebscoType").hide()}},processSearchForm:function(){var searchSource=$("#searchSource");if(searchSource.val()=="existing"){$(".existingFilter").prop("checked",true);var originalSearchSource=$("#existing_search_option").data("original_type");searchSource.val(originalSearchSource)}},resetSearchType:function(){if($("#lookfor").val()==""){$("#searchSource").val($("#default_search_type").val())}return true},updateSearchTypes:function(catalogType,searchType,searchFormId){if(catalogType=="catalog"){$("#basicType").val(searchType);$("#genealogyType").remove();$("#islandoraType").remove();$("#ebscoType").remove()}else if(catalogType=="archive"){$("#islandoraType").val(searchType);$("#genealogyType").remove();$("#ebscoType").remove();$("#basicType").remove()}else if(catalogType=="ebsco"){$("#ebscoType").val(searchType);$("#genealogyType").remove();$("#islandoraType").remove();$("#basicType").remove()}else{$("#genealogyType").val(searchType);$("#basicType").remove();$("#islandoraType").remove();$("#ebscoType").remove()}$(searchFormId).submit();return false},filterAll:function(){$(".existingFilter").prop("checked",true)},loadExploreMoreBar:function(section,searchTerm){var url="/Search/AJAX";var params="method=loadExploreMoreBar&section="+encodeURIComponent(section);params+="&searchTerm="+encodeURIComponent(searchTerm);var fullUrl=url+"?"+params;$.getJSON(fullUrl,function(data){if(data.success==true){$("#explore-more-bar-placeholder").html(data.exploreMoreBar);Pika.initCarousels()}})}}}(Pika.Searches||{});