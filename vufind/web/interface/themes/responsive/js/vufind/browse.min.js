VuFind.Browse=function(){return{curPage:1,curCategory:"",curSubCategory:"",browseMode:"covers",browseModeClasses:{covers:"home-page-browse-thumbnails",grid:"home-page-browse-grid"},addToHomePage:function(searchId){VuFind.Account.ajaxLightbox("/Browse/AJAX?method=getAddBrowseCategoryForm&searchId="+searchId,true);return false},initializeBrowseCategory:function(){var browseCategoryCarousel=$("#browse-category-carousel");browseCategoryCarousel.on("jcarousel:targetin","li",function(){var categoryId=$(this).data("category-id");VuFind.Browse.changeBrowseCategory(categoryId)});if($("#browse-category-picker .jcarousel-control-prev").css("display")!="none"){browseCategoryCarousel.find("li").click(function(){$("#browse-category-carousel").jcarousel("scroll",$(this))});var scrollFactor=15;browseCategoryCarousel.touchwipe({wipeLeft:function(dx){var scrollInterval=Math.round(dx/scrollFactor);$("#browse-category-carousel").jcarousel("scroll","+="+scrollInterval)},wipeRight:function(dx){var scrollInterval=Math.round(dx/scrollFactor);$("#browse-category-carousel").jcarousel("scroll","-="+scrollInterval)}})}else{browseCategoryCarousel.find("li").click(function(){$(this).trigger("jcarousel:targetin")})}},toggleBrowseMode:function(selectedMode){var mode=this.browseModeClasses.hasOwnProperty(selectedMode)?selectedMode:this.browseMode,categoryTextId=this.curCategory||$("#browse-category-carousel .selected").data("category-id"),subCategoryTextId=this.curSubCategory||$("#browse-sub-category-menu .selected").data("sub-category-id");this.browseMode=mode;if(!Globals.opac&&VuFind.hasLocalStorage()){window.localStorage.setItem("browseMode",this.browseMode)}if(subCategoryTextId)return this.changeBrowseSubCategory(subCategoryTextId);else return this.changeBrowseCategory(categoryTextId)},resetBrowseResults:function(){var classes=function(){var str="",object=VuFind.Browse.browseModeClasses;for(property in object){str+=object[property]+" "}return str}(),selectedClass=this.browseModeClasses[this.browseMode];$("#home-page-browse-results").children().fadeOut(function(){$("#home-page-browse-results").children().slice(1).remove();$("#home-page-browse-results div.row").removeClass(classes).addClass(selectedClass)})},changeBrowseCategory:function(categoryTextId){var url="/Browse/AJAX",params={method:"getBrowseCategoryInfo",textId:categoryTextId||VuFind.Browse.curCategory,browseMode:this.browseMode},newLabel=$("#browse-category-"+categoryTextId+" div").first().text(),loadingID=categoryTextId||initial;$(".browse-category").removeClass("selected");$("#browse-category-"+categoryTextId).addClass("selected");$("#selected-browse-search-link").attr("href","#");$(".selected-browse-label-search-text,.selected-browse-sub-category-label-search-text").fadeOut(function(){$(".selected-browse-label-search-text").html(newLabel).fadeIn()});$("#browse-sub-category-menu").children().fadeOut(function(){$(this).remove()});this.resetBrowseResults();this.loadingCategory=loadingID;$.getJSON(url,params,function(data){if(VuFind.Browse.loadingCategory==loadingID){if(data.success==false){VuFind.showMessage("Error loading browse information","Sorry, we were not able to find titles for that category")}else{$(".selected-browse-label-search-text").html(data.label);VuFind.Browse.curPage=1;VuFind.Browse.curCategory=data.textId;VuFind.Browse.curSubCategory=data.subCategoryTextId||"";$("#home-page-browse-results div.row").html(data.records).fadeIn("slow");$("#selected-browse-search-link").attr("href",data.searchUrl);if(data.subcategories){$("#browse-sub-category-menu").html(data.subcategories).fadeIn();if(data.subCategoryTextId){$(".selected-browse-sub-category-label-search-text").html($("#browse-sub-category-"+data.subCategoryTextId).addClass("selected").text()).fadeIn()}}}}}).fail(function(){VuFind.ajaxFail();$("#home-page-browse-results div").html("").show()}).done(function(){VuFind.Browse.loadingCategory=null});return false},changeBrowseSubCategory:function(subCategoryTextId){var url="/Browse/AJAX",params={method:"getBrowseSubCategoryInfo",textId:VuFind.Browse.curCategory,subCategoryTextId:subCategoryTextId,browseMode:this.browseMode};$("#browse-sub-category-menu button").removeClass("selected");$("#browse-sub-category-"+subCategoryTextId).addClass("selected");newSubCategoryLabel=$("#browse-sub-category-"+subCategoryTextId).text();$(".selected-browse-sub-category-label-search-text").fadeOut(function(){$(this).html(newSubCategoryLabel).fadeIn()});this.resetBrowseResults();$.getJSON(url,params,function(data){if(data.success==false){VuFind.showMessage("Error loading browse information","Sorry, we were not able to find titles for that category")}else{if(data.label)$(".selected-browse-label-search-text").html(data.label);if(data.subCategoryLabel)$(".selected-browse-sub-category-label-search-text").html(data.subCategoryLabel);else $(".selected-browse-sub-category-label-search-text").fadeOut();VuFind.Browse.curPage=1;if(data.textId)VuFind.Browse.curCategory=data.textId;if(data.subCategoryTextId)VuFind.Browse.curSubCategory=data.subCategoryTextId||"";$("#home-page-browse-results div.row").html(data.records).fadeIn("slow");$("#selected-browse-search-link").attr("href",data.searchUrl)}}).fail(function(){VuFind.ajaxFail();$("#home-page-browse-results div.row").html("").show();$(".selected-browse-sub-category-label-search-text").fadeOut()});return false},createBrowseCategory:function(){var url="/Browse/AJAX",params={method:"createBrowseCategory",categoryName:$("#categoryName").val(),addAsSubCategoryOf:$("#addAsSubCategoryOfSelect").val()};var searchId=$("#searchId");if(searchId){params["searchId"]=searchId.val()}var listId=$("#listId");if(listId){params["listId"]=listId.val()}$.getJSON(url,params,function(data){if(data.success==false){VuFind.showMessage("Unable to create category",data.message)}else{VuFind.showMessage("Successfully added","This search was added to the homepage successfully.",true)}}).fail(VuFind.ajaxFail);return false},getMoreResults:function(){this.curPage+=1;var url="/Browse/AJAX",params={method:"getMoreBrowseResults",textId:this.curSubCategory||this.curCategory,pageToLoad:this.curPage,browseMode:this.browseMode},divClass=this.browseModeClasses[this.browseMode];$.getJSON(url,params,function(data){if(data.success==false){VuFind.showMessage("Error loading browse information","Sorry, we were not able to find titles for that category")}else{var newDiv=$('<div class="'+divClass+' row" />').hide().append(data.records);$("."+divClass).filter(":last").after(newDiv).after("<hr>");newDiv.fadeIn("slow");if(data.lastPage){$("#more-browse-results").hide()}}}).fail(VuFind.ajaxFail);return false}}}(VuFind.Browse||{});